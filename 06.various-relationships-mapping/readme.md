# 다양한 연관관계 매핑

- **엔티티의 연관관계를 매핑할 때 고려 사항**
    - 다중성
        - N:1(`@ManyToOne`)
        - 1:N(`@OneToMany`)
        - 1:1(`@OneToOne`)
        - N:M(`@ManyToMany`)
    - 단방향, 양방향
        - 테이블은 외래 키 하나로 JOIN를 사용해서 양방향으로 쿼리가 가능하므로 방향이라는 개념이 없다.
        - 객체는 참조형 필드를 가지고 있는 객체만 연관된 객체를 조회할 수 있다.
            - 단방향 관계: 한 쪽만 참조하는 것
            - 양방향 관계; 양쪽이 서로 참조하는 것
    - 연관관계 주인
        - 데이터베이스는 외래 키 하나로 두 테이블간 연관관계를 맺는다. 따라서 테이블의 연관관계를 관리하는 포인트는 외래 키 하나다.
        - 엔티티는 양방향으로 매핑하는 서로를 참조하여, 객체의 연관관계를 관리하는 포인트는 2곳이다.

# N:1(`@ManyToOne`)

데이터베이스는 테이블의 1:N관계에서 외래 키는 항상 N쪽이므로 객체 양방향 관계에서 연관관계의 주인은 항상 N쪽이다.

## N:1 단방향

## N:1 양방향

- 양방향은 외래 키가 있는 쪽이 연관관계의 주인이다.  
    1:N, N:1 연관관계는 항상 N쪽에 외래 키가 있다. JPA는 외래 키를 관리할 때 연관관계의 주인만 사용한다. 주인이 아닌 엔티티는 조회를 위한 JPQL이나 객체 그래프를 탐색할 떄 사용한다.
- 양방향 연관관계는 항상 서로를 참조해야 한다.  
    어느 한 쪽만 참조하면 양방향 연관관계가 성립하지 않는다. 항상 서로 참조하게 하려면 연관관계 편의 메서드를 작성하는 것이 좋다. 편의 메소드는 한 곳에만 작성하거나 양쪽 다 작성할 수 있는데, 양쪽에 작성하면 무한 루프에 빠지므로 주의해야 한다.

# 1:N(`@OneToMany`)

1:N는 엔티티를 하나 이상 참조할 수 있으므로 자바 컬렉션(`Collection`, `List`, `Set`, `Map`)를 사용해야 한다.

## 1:N 단방향

- 1:N 단방향 매핑의 단점  
    1:N 단방향 매핑의 단점은 매핑한 객체가 관리하는 외래 키가 다른 테이블에 있다는 점이다. 본인 테이블에 외래 키가 있으면 엔티티의 저장과 연관관계 처리를 INSERT SQL 한 번으로 끝낼 수 있지만, 다른 데이블에 외래 키가 있으면 연관관계 처리를 위한 UPDATE SQL를 추가로 실행해야 한다.(N쪽인 엔티티는 1쪽인 엔티티를 모르고 연관관계에 대한 정보는 1쪽인 엔티티의 연관관계 주인인 필드에서 관리하고 있기 때문)
- 1:N 단방향 매핑보다는 N:1 양방향 매핑을 사용을 권장
    1:N 단방향 매핑은 엔티티를 매핑한 테이블이 아닌 다른 테이블의 외래 키를 관리해야 한다. 성능의 문제도 있지만 관리도 부담스럽다. 대신 N:1 양방향 매핑은 관리해야 하는 외래 키가 본인 테이블에 있다. 따라서 1:N 단방향 매핑와 같은 문제가 발생하지 않는다.

# 1:1

1:1 관계는 양쪽이 서로 하나의 관계만 가진다. 주 테이블이나 대상 테이블 둘 중 어느 곳이나 외래 키를 가질 수 있다.

테이블은 주 테이블이든 대상 테이블이든 외래 키 하나만 있으면 양쪽으로 조회할 수 있다.

<!-- ## 주 테이블에 외래키

## 대상 테이블 외래 키

# N:N -->